<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Material Design Lite</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-pink.min.css">
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/dropload.css">
    <style>
        #more-fab {
            position: fixed;
            display: block;
            right: 0;
            bottom: 0;
            margin-right: 40px;
            margin-bottom: 40px;
            z-index: 900;
        }
        .container{
            padding-right:15px;
            padding-left:15px;
            margin-right:auto;
            margin-left:auto
        }

        @media (min-width:768px){
            .container{
                width:750px
            }

        }

        @media (min-width:992px){
            .container{
                width:970px
            }

        }

        @media (min-width:1200px) {
            .container {
                width: 1170px
            }
        }
        h3{
            line-height: 8px;

        }


    </style>
</head>
<body class="chsh mdl-color--grey-100 mdl-color-text--grey-700 mdl-base">
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <!-- 导航栏开始 -->
    <header class="mdl-layout__header mdl-layout__header--waterfall mdl-color--primary">
        <!--为了header大一点设置的header-row-->
        <div class="mdl-layout--large-screen-only mdl-layout__header-row">

        </div>
        <div class="mdl-layout mdl-layout__header-row">
            <h3>CHSH的博客</h3>
        </div>
        <div class=" mdl-layout__header-row">
            <div class="mdl-layout-spacer"></div>
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable
                  mdl-textfield--floating-label mdl-textfield--align-right">
                <label id="search" class="mdl-button mdl-js-button mdl-button--icon"
                       for="waterfall-exp">
                    <i class="material-icons">search</i>
                </label>
                <div class="mdl-textfield__expandable-holder">
                    <input class="mdl-textfield__input" type="text" name="sample"
                           id="waterfall-exp">
                </div>
            </div>
        </div>
        <div class="mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark">
            <a href="/" class="mdl-layout__tab">主页</a>
            <a href="/article/articlePage" class="mdl-layout__tab is-active">文章列表</a>
            <a href="/page" class="mdl-layout__tab">推荐</a>
            <a href="/aboutUs" class="mdl-layout__tab">关于我们</a>
            <a href="/article/writeArticle" id="submitArticle" class="mdl-layout__tab">发布文章</a>
        </div>
    </header>

    <!-- 导航栏结束 -->
    <main class="mdl-layout__content">
        <div class="container passageContent">
        <div class="mdl-grid passageList">
             <!--card-->
            <!--<%for (var i=0;i<passages.length;i++){%>-->
            <!--<section class="section&#45;&#45;center mdl-grid mdl-grid&#45;&#45;no-spacing mdl-cell&#45;&#45;12-col mdl-shadow&#45;&#45;2dp">-->
                <!--<div class="mdl-card mdl-cell mdl-cell&#45;&#45;12-col">-->
                    <!--<div class="mdl-card__supporting-text">-->
                        <!--<h4><%=passages[i].articleTitle%></h4>-->
                        <!--作者：<%=passages[i].articleAuthor%> | <%=passages[i].articleWriteDate%> | 标签：<%=passages[i].articleWriteDate%>-->
                    <!--</div>-->
                    <!--<div class="mdl-card__actions">-->
                        <!--<a href="/article/articleDetail/<%=passages[i].articleId%>" class="mdl-button">阅读全文</a>-->
                    <!--</div>-->
                <!--</div>-->
                <!--&lt;!&ndash; 菜单 &ndash;&gt;-->

            <!--</section>-->
            <!--<%}%>-->
        </div>
        </div>
        <!-- 下方状态栏结束 -->
        <footer class="mdl-mini-footer">
            <div class="mdl-mini-footer__left-section">
                <div class="mdl-logo">CHSH'sBlog</div>
                <ul class="mdl-mini-footer__link-list">
                    <li><a href="/mdl">We Use Google Material Degisn Lite</a></li>
                    <li><a href="#">ZUCC-CHSH Group</a></li>
                </ul>
            </div>
        </footer>
    </main>
</div>
<ul class="mdl-menu  mdl-menu--top-right mdl-js-menu mdl-js-ripple-effect" for="more-fab" style="margin-bottom: 10px;">
    <!--<li class="mdl-menu__item">个人信息</li>-->
    <a class="mdl-menu__item" href="/users/loginPage" id="login-item" style="color: black">登录</a>
    <a class="mdl-menu__item" href="/users/logout" id="logout" style="color: black">登出</a>
    <!--<li class="mdl-menu__item" id="ToTop">返回顶部</li>-->
</ul>
<a id="more-fab" class="mdl-button mdl-js-button  mdl-js-ripple-effect mdl-color--accent mdl-color-text--accent-contrast">未登陆</a>
<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<script src="/js/dropload.min.js"></script>
<script src="/js/jquerysession.js"></script>
</body>
<script type="text/javascript">
     $(function(){

         if($.session.get('user')===undefined||$.session.get('role')==='visitor'){
             $('#submitArticle').remove();
         }
         var page=0;
         var size=5;
         $('.passageContent').dropload({
             scrollArea: window,
             loadDownFn:function(me){
                 page++;
                 var result='';
                 $.ajax({
                     type: 'GET',
                     url: 'http://127.0.0.1:3000/article/getAll?page='+page+'&size='+size,
                     dataType: 'json',
                     success:function(passages){
                         console.log(passages);
                         var arrLen=passages.length;
                         if(arrLen>0){
                             for(var i=0;i<arrLen;i++){

                                 result+='<section class="section--center mdl-grid mdl-grid--no-spacing mdl-cell--12-col mdl-shadow--2dp opacity">'+
                                    '<div class="mdl-card mdl-cell mdl-cell--12-col">'+
                                     '<div class="mdl-card__supporting-text">'+
                                     '<h4>'+passages[i].articleTitle+'</h4>'+ ' 作者：'+passages[i].articleAuthor+'|'+passages[i].articleWriteDate+' | 标签：'+passages[i].tags+
                             '</div>'+
                                 '<div class="mdl-card__actions">'+
                                    ' <a href="/article/articleDetail/'+passages[i].articleId+'" class="mdl-button">阅读全文</a>'+
                                     '</div>'+
                                     '</div>'+ '</section>'
                             }
                         }
                         // 如果没有数据
                         else{
                             // 锁定
                             me.lock();
                             // 无数据
                             me.noData();
                         }
                         setTimeout(function () {
                             $('.passageList').append(result);
                             // 每次数据插入，必须重置
                             me.resetload();
                         },2000);
                     },
                     error: function(xhr, err){
                         console.log(err.message);
                         alert('Ajax error!');
                         // 即使加载出错，也得重置
                         me.resetload();
                     }
                 })
             }
         })
         $("#search").click(function(){
             var searchContent=$("#waterfall-exp").val();
             if(searchContent!==""){
                 window.location.href="http://127.0.0.1:3000/article/articleSearch?q="+searchContent;
             }
         })
     })
</script>
<script type="text/javascript" src="/js/jquerysession.js"></script>
<script>
    $(document).ready(function () {
        if($.session.get('user')===undefined||$.session.get('role')==='visitor'){
            $('#submitArticle').remove();
            $("#more-fab").text("未登陆");
        }
        if($.session.get('user')!=undefined){
            $("#more-fab").text('你好 '+$.session.get('user'));
            $("#login-item").remove();
        }
        $("#ToTop").click(function () {
            // $('html, body').animate({scrollTop: 0}, 500);
            scrollTo(0,0)
            // alert("click")
        })
        $("#logout").click(function () {
            $.session.clear();
        })
    })
</script>
</html>